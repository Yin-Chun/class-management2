<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒŸ ç­ç´šç®¡ç†å°å¹«æ‰‹ ğŸŒŸ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Microsoft JhengHei", "å¾®è»Ÿæ­£é»‘é«”", Arial, sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #B0E0E6 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* é ‚éƒ¨è³‡è¨Šå€ */
        .header {
            background: #FFD93D;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            text-align: center;
            border: 3px solid #2C3E50;
        }

        .header h1 {
            color: #FF6B6B;
            font-size: 2.5em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .datetime {
            font-size: 1.6em;
            color: #2C3E50;
            margin-bottom: 15px;
            font-weight: bold;
            background: rgba(255,255,255,0.6);
            padding: 12px 20px;
            border-radius: 15px;
            display: inline-block;
        }

        .quote {
            font-size: 1.3em;
            padding: 18px;
            background: #FF6B6B;
            border-radius: 15px;
            margin-top: 15px;
            color: white;
            font-weight: bold;
        }

        /* ä¸»è¦å…§å®¹å€ */
        .main-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border: 3px solid #2C3E50;
            border-radius: 20px;
        }

        /* ä¸åŒå¡ç‰‡ä¸åŒé¡è‰² */
        .card:nth-child(1) {
            background: #6BCB77;
        }

        .card:nth-child(2) {
            background: #FFB84D;
        }

        .card:nth-child(3) {
            background: #A084DC;
        }

        .card:nth-child(4) {
            background: #FF6B9D;
        }

        .card h2 {
            color: white;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 3px solid rgba(255,255,255,0.5);
            font-weight: bold;
        }

        /* æé†’ç³»çµ± */
        .reminder-input, .time-input {
            padding: 12px;
            font-size: 1.1em;
            border: 3px solid #2C3E50;
            border-radius: 10px;
            margin-bottom: 10px;
            background: white;
        }

        .reminder-input {
            width: 100%;
        }

        .time-input {
            width: 48%;
        }

        button {
            background: #FF6B6B;
            color: white;
            border: 3px solid #2C3E50;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
            font-weight: bold;
        }

        button:hover {
            background: #E74C3C;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        button:active {
            transform: translateY(0px);
        }

        .reminder-list {
            margin-top: 15px;
        }

        .reminder-item {
            background: rgba(255,255,255,0.9);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid rgba(0,0,0,0.2);
        }

        .reminder-item button {
            background: #E74C3C;
            padding: 8px 15px;
            font-size: 0.95em;
        }

        /* å€¼æ—¥ç”Ÿç³»çµ± */
        .duty-students {
            font-size: 1.4em;
            color: #2C3E50;
            padding: 18px;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            margin: 15px 0;
            text-align: center;
            border: 2px dashed #2C3E50;
        }

        .duty-students .student {
            display: inline-block;
            background: #4ECDC4;
            color: white;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            font-weight: bold;
            border: 3px solid #2C3E50;
        }

        /* ä½œæ¥­é»å */
        .homework-display {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .homework-display::-webkit-scrollbar {
            width: 10px;
        }

        .homework-display::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }

        .homework-display::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .homework-title {
            font-size: 1.3em;
            font-weight: bold;
            color: white;
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
        }

        .homework-section {
            margin-bottom: 15px;
        }

        .homework-section-title {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 8px;
        }

        .homework-section-title.missing {
            background: #FF6B6B;
            color: white;
        }

        .homework-section-title.leave {
            background: #FFD93D;
            color: #2C3E50;
        }

        .homework-student-item {
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 6px;
            font-size: 1.1em;
            font-weight: bold;
            border: 2px solid rgba(0,0,0,0.2);
        }

        .homework-student-item.missing {
            background: #FFCCCB;
            color: #C0392B;
        }

        .homework-student-item.leave {
            background: #FFF4B3;
            color: #7D6608;
        }

        .student-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .student-list::-webkit-scrollbar {
            width: 10px;
        }

        .student-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.3);
            border-radius: 10px;
        }

        .student-list::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .student-item {
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            border: 2px solid rgba(0,0,0,0.2);
            font-weight: bold;
        }

        .student-item.completed {
            background: #B4E7CE;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .student-item input[type="checkbox"] {
            width: 28px;
            height: 28px;
            cursor: pointer;
            accent-color: #FF6B6B;
        }

        /* å¤§å­—å ±æé†’ */
        .alert-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 193, 7, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .alert-overlay.show {
            display: flex;
        }

        .alert-box {
            background: #FFD93D;
            padding: 50px;
            border-radius: 25px;
            text-align: center;
            max-width: 80%;
            animation: bounce 0.5s;
            border: 5px solid #FF6B6B;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }

        .alert-box h2 {
            font-size: 3em;
            color: #E74C3C;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .alert-box p {
            font-size: 2em;
            margin: 20px 0;
            color: #2C3E50;
            font-weight: bold;
        }

        .alert-box button {
            font-size: 1.5em;
            padding: 15px 40px;
            background: #4ECDC4;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* è¼¸å…¥å€ */
        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: white;
            font-size: 1.1em;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 3px solid #2C3E50;
            border-radius: 10px;
            background: white;
        }

        /* è¨­å®šå€ */
        .settings {
            background: #FF6B9D;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            border: 3px solid #2C3E50;
        }

        .settings h2 {
            color: white;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .settings textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 3px solid #2C3E50;
            font-size: 1em;
            background: white;
        }

        /* è¯çµ¡ç°¿ç³»çµ± */
        .contact-list {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .contact-item {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 2px solid rgba(0,0,0,0.2);
            position: relative;
        }

        .contact-item .date {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .contact-item .content {
            font-size: 1.1em;
            color: #2C3E50;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .contact-item button {
            background: #E74C3C;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .contact-input-area {
            margin-bottom: 15px;
        }

        .contact-input-area textarea {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 3px solid #2C3E50;
            border-radius: 10px;
            background: white;
            min-height: 80px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é ‚éƒ¨è³‡è¨Šå€ -->
        <div class="header">
            <h1>ğŸŒŸ ç­ç´šç®¡ç†å°å¹«æ‰‹ ğŸŒŸ</h1>
            <div class="datetime" id="datetime"></div>
            <div class="quote" id="quote"></div>
        </div>

        <!-- ä¸»è¦å…§å®¹å€ -->
        <div class="main-content">
            <!-- æé†’ç³»çµ± -->
            <div class="card">
                <h2>â° æé†’äº‹é …</h2>
                <div class="reminder-list" id="reminderList"></div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 3px solid rgba(255,255,255,0.5);">
                    <input type="time" class="time-input" id="reminderTime" placeholder="æ™‚é–“">
                    <input type="text" class="reminder-input" id="reminderText" placeholder="è¼¸å…¥æé†’äº‹é …...">
                    <button onclick="addReminder()">â• æ–°å¢æé†’</button>
                </div>
            </div>

            <!-- å€¼æ—¥ç”Ÿç³»çµ± -->
            <div class="card">
                <h2>ğŸ§¹ ä»Šæ—¥å€¼æ—¥ç”Ÿ</h2>
                <div class="duty-students" id="dutyStudents"></div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 3px solid rgba(255,255,255,0.5);">
                    <div class="input-group">
                        <label>ç­ç´šç¸½äººæ•¸ï¼š</label>
                        <input type="number" id="totalStudents" value="30" min="4">
                        <button onclick="saveTotalStudents()">ğŸ’¾ å„²å­˜äººæ•¸</button>
                    </div>
                    <div class="input-group">
                        <label>èµ·å§‹åº§è™Ÿï¼š</label>
                        <input type="number" id="startNumber" value="1" min="1">
                        <button onclick="setDutyStart()">è¨­å®šèµ·å§‹åº§è™Ÿ</button>
                    </div>
                    <button onclick="previousDutyDay()">â¬…ï¸ ä¸Šä¸€å¤©</button>
                    <button onclick="nextDutyDay()">â¡ï¸ ä¸‹ä¸€å¤©</button>
                    <button onclick="resetDuty()">ğŸ”„ é‡æ–°é–‹å§‹</button>
                </div>
            </div>

            <!-- ä½œæ¥­é»åç³»çµ± -->
            <div class="card">
                <h2>ğŸ“š ä½œæ¥­é»å</h2>
                <div id="homeworkDisplay" style="min-height: 100px;">
                    <div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">è«‹è¼¸å…¥ä½œæ¥­åç¨±ä¸¦æ¨™è¨˜å­¸ç”Ÿ</div>
                </div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 3px solid rgba(255,255,255,0.5);">
                    <div class="input-group">
                        <label>ä½œæ¥­åç¨±ï¼š</label>
                        <input type="text" id="homeworkName" placeholder="ä¾‹å¦‚ï¼šæ•¸å­¸ç¿’ä½œ p.15-20">
                    </div>
                    <div class="input-group">
                        <label>ç¼ºäº¤è€…åº§è™Ÿï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰ï¼š</label>
                        <input type="text" id="missingStudents" placeholder="ä¾‹å¦‚ï¼š1,3,5,8">
                    </div>
                    <div class="input-group">
                        <label>è«‹å‡è€…åº§è™Ÿï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰ï¼š</label>
                        <input type="text" id="leaveStudents" placeholder="ä¾‹å¦‚ï¼š2,7">
                    </div>
                    <button onclick="saveHomeworkRecord()">ğŸ’¾ å„²å­˜è¨˜éŒ„</button>
                    <button onclick="clearHomeworkDisplay()">ğŸ—‘ï¸ æ¸…é™¤é¡¯ç¤º</button>
                </div>
            </div>

            <!-- è¯çµ¡ç°¿ç³»çµ± -->
            <div class="card">
                <h2>ğŸ“ è¯çµ¡ç°¿äº‹é …</h2>
                <div class="contact-list" id="contactList"></div>
                <div style="margin-top: 20px; padding-top: 20px; border-top: 3px solid rgba(255,255,255,0.5);">
                    <div class="contact-input-area">
                        <textarea id="contactText" placeholder="è¼¸å…¥ä»Šæ—¥è¯çµ¡ç°¿äº‹é …..."></textarea>
                        <button onclick="addContactItem()">â• æ–°å¢äº‹é …</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- è¨­å®šå€ -->
        <div class="settings">
            <h2>âš™ï¸ å­¸ç”Ÿåå–®è¨­å®š</h2>
            <div class="input-group">
                <label>å­¸ç”Ÿå§“åï¼ˆä¸€è¡Œä¸€å€‹ï¼‰ï¼š</label>
                <textarea id="studentNames" rows="6" style="width: 100%; padding: 10px; border-radius: 10px; border: 2px solid #ddd; font-size: 1em;"></textarea>
                <button onclick="saveStudentNames()">ğŸ’¾ å„²å­˜å­¸ç”Ÿåå–®</button>
            </div>
        </div>
    </div>

    <!-- å¤§å­—å ±æé†’ -->
    <div class="alert-overlay" id="alertOverlay">
        <div class="alert-box">
            <h2 id="alertTitle">â° æé†’æ™‚é–“åˆ°äº†ï¼</h2>
            <p id="alertMessage" style="font-size: 2em; margin: 20px 0;"></p>
            <button onclick="closeAlert()">âœ“ çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // æ¯æ—¥è‚¯å®šå¥
        const quotes = [
            "ä»Šå¤©çš„ä½ ï¼Œæ˜¯æœ€æ£’çš„ï¼ğŸ’ª",
            "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å¯ä»¥åšå¾—æ›´å¥½ï¼â­",
            "æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„é–‹å§‹ï¼ğŸŒ…",
            "åŠªåŠ›çš„ä½ ï¼ŒçœŸçš„å¾ˆç¾ï¼ğŸŒ¸",
            "å …æŒä¸‹å»ï¼ŒæˆåŠŸå°±åœ¨å‰æ–¹ï¼ğŸ¯",
            "ä½ çš„ç¬‘å®¹ï¼Œèƒ½ç…§äº®æ•´å€‹æ•™å®¤ï¼ğŸ˜Š",
            "å­¸ç¿’ä½¿æˆ‘å€‘æ›´å¼·å¤§ï¼ğŸ“š",
            "ä»Šå¤©åˆæ˜¯å……æ»¿å¸Œæœ›çš„ä¸€å¤©ï¼ğŸŒˆ",
            "å‹å–„å¾…äººï¼Œå¿«æ¨‚åŠ å€ï¼ğŸ¤",
            "èªçœŸçš„æ…‹åº¦ï¼Œæ˜¯æˆåŠŸçš„é—œéµï¼ğŸ”‘",
            "æ¯å€‹äººéƒ½æ˜¯ç¨ä¸€ç„¡äºŒçš„å¯¶è²ï¼ğŸ’",
            "å‹‡æ•¢å˜—è©¦ï¼Œä¸æ€•å¤±æ•—ï¼ğŸš€",
            "åœ˜éšŠåˆä½œï¼ŒåŠ›é‡ç„¡çª®ï¼ğŸ‘¥",
            "ä¿æŒå¥½å¥‡å¿ƒï¼Œä¸–ç•Œæ›´ç²¾å½©ï¼ğŸ”",
            "å–„è‰¯æ˜¯æœ€ç¾çš„å“æ ¼ï¼â¤ï¸"
        ];

        // æé†’éŸ³æ•ˆï¼ˆä½¿ç”¨ Web Audio APIï¼‰
        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);

            // æ’­æ”¾ä¸‰æ¬¡
            setTimeout(() => playBeep(), 600);
            setTimeout(() => playBeep(), 1200);
        }

        function playBeep() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // æ›´æ–°æ™‚é–“å’Œæ—¥æœŸ
        function updateDateTime() {
            const now = new Date();
            const options = {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            document.getElementById('datetime').textContent = now.toLocaleDateString('zh-TW', options);

            // æª¢æŸ¥æé†’
            checkReminders(now);
        }

        // é¡¯ç¤ºæ¯æ—¥è‚¯å®šå¥
        function showDailyQuote() {
            const today = new Date().toDateString();
            const savedDate = localStorage.getItem('quoteDate');

            if (savedDate !== today) {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                document.getElementById('quote').textContent = randomQuote;
                localStorage.setItem('quoteDate', today);
                localStorage.setItem('todayQuote', randomQuote);
            } else {
                const savedQuote = localStorage.getItem('todayQuote') || quotes[0];
                document.getElementById('quote').textContent = savedQuote;
            }
        }

        // æé†’ç³»çµ±
        function addReminder() {
            const time = document.getElementById('reminderTime').value;
            const text = document.getElementById('reminderText').value;

            if (!time || !text) {
                alert('è«‹è¼¸å…¥æ™‚é–“å’Œæé†’å…§å®¹ï¼');
                return;
            }

            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            reminders.push({ time, text });
            localStorage.setItem('reminders', JSON.stringify(reminders));

            document.getElementById('reminderTime').value = '';
            document.getElementById('reminderText').value = '';

            displayReminders();
        }

        function displayReminders() {
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            const list = document.getElementById('reminderList');

            list.innerHTML = reminders.map((r, index) => `
                <div class="reminder-item">
                    <span><strong>${r.time}</strong> - ${r.text}</span>
                    <button onclick="deleteReminder(${index})">åˆªé™¤</button>
                </div>
            `).join('');
        }

        function deleteReminder(index) {
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            reminders.splice(index, 1);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            displayReminders();
        }

        function checkReminders(now) {
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            const reminders = JSON.parse(localStorage.getItem('reminders') || '[]');
            const checkedKey = `checked_${currentTime}_${new Date().toDateString()}`;

            if (localStorage.getItem(checkedKey)) return;

            reminders.forEach(reminder => {
                if (reminder.time === currentTime) {
                    showAlert(reminder.text);
                    playNotificationSound();
                    localStorage.setItem(checkedKey, 'true');
                }
            });
        }

        function showAlert(message) {
            document.getElementById('alertMessage').textContent = message;
            document.getElementById('alertOverlay').classList.add('show');
        }

        function closeAlert() {
            document.getElementById('alertOverlay').classList.remove('show');
        }

        // å€¼æ—¥ç”Ÿç³»çµ±
        function saveTotalStudents() {
            const total = parseInt(document.getElementById('totalStudents').value);
            if (!total || total < 4) {
                alert('ç­ç´šäººæ•¸è‡³å°‘éœ€è¦4äººï¼');
                return;
            }

            const currentStart = parseInt(localStorage.getItem('dutyStart') || '1');
            if (currentStart > total) {
                alert(`ç›®å‰èµ·å§‹åº§è™Ÿï¼ˆ${currentStart}ï¼‰è¶…éç­ç´šäººæ•¸ï¼Œå·²è‡ªå‹•é‡è¨­ç‚ºåº§è™Ÿ1`);
                localStorage.setItem('dutyStart', '1');
            }

            localStorage.setItem('totalStudents', total);
            displayDutyStudents();
            alert(`å·²å„²å­˜ï¼ç­ç´šç¸½äººæ•¸è¨­å®šç‚º ${total} äºº`);
        }

        function updateDutyStudents() {
            const total = parseInt(document.getElementById('totalStudents').value);
            if (total < 4) {
                alert('ç­ç´šäººæ•¸è‡³å°‘éœ€è¦4äººï¼');
                return;
            }
            localStorage.setItem('totalStudents', total);
            displayDutyStudents();
        }

        function setDutyStart() {
            const total = parseInt(localStorage.getItem('totalStudents') || '30');
            const startNum = parseInt(document.getElementById('startNumber').value);

            if (!startNum || startNum < 1) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„èµ·å§‹åº§è™Ÿï¼ˆè‡³å°‘ç‚º1ï¼‰ï¼');
                return;
            }

            if (startNum > total) {
                alert(`èµ·å§‹åº§è™Ÿä¸èƒ½è¶…éç­ç´šç¸½äººæ•¸ï¼ˆ${total}äººï¼‰ï¼`);
                return;
            }

            localStorage.setItem('dutyStart', startNum);
            localStorage.setItem('dutyLastUpdate', new Date().toDateString());
            displayDutyStudents();
            alert(`å·²è¨­å®šå¾åº§è™Ÿ ${startNum} é–‹å§‹å€¼æ—¥ï¼`);
        }

        function displayDutyStudents() {
            const total = parseInt(localStorage.getItem('totalStudents') || '30');
            const currentStart = parseInt(localStorage.getItem('dutyStart') || '1');

            // æ›´æ–°è¼¸å…¥æ¡†é¡¯ç¤ºå€¼
            document.getElementById('totalStudents').value = total;
            document.getElementById('startNumber').value = currentStart;

            const students = [];
            for (let i = 0; i < 4; i++) {
                let num = ((currentStart + i - 1) % total) + 1;
                students.push(num);
            }

            document.getElementById('dutyStudents').innerHTML =
                students.map(num => `<span class="student">åº§è™Ÿ ${num}</span>`).join('');
        }

        function previousDutyDay() {
            const total = parseInt(localStorage.getItem('totalStudents') || '30');
            const currentStart = parseInt(localStorage.getItem('dutyStart') || '1');
            // æ¯å¤©å¾Œé€€2å€‹åº§è™Ÿï¼ˆ5,6,7,8 â†’ 3,4,5,6 â†’ 1,2,3,4ï¼‰
            const newStart = ((currentStart - 1 - 2 + total) % total) + 1;
            localStorage.setItem('dutyStart', newStart);
            localStorage.setItem('dutyLastUpdate', new Date().toDateString());
            displayDutyStudents();
        }

        function nextDutyDay() {
            const total = parseInt(localStorage.getItem('totalStudents') || '30');
            const currentStart = parseInt(localStorage.getItem('dutyStart') || '1');
            // æ¯å¤©å‰é€²2å€‹åº§è™Ÿï¼ˆ1,2,3,4 â†’ 3,4,5,6 â†’ 5,6,7,8ï¼‰
            const newStart = ((currentStart - 1 + 2) % total) + 1;
            localStorage.setItem('dutyStart', newStart);
            localStorage.setItem('dutyLastUpdate', new Date().toDateString());
            displayDutyStudents();
        }

        function resetDuty() {
            if (confirm('ç¢ºå®šè¦å°‡å€¼æ—¥ç”Ÿé‡è¨­ç‚ºå¾åº§è™Ÿ1é–‹å§‹å—ï¼Ÿ')) {
                localStorage.setItem('dutyStart', '1');
                localStorage.setItem('dutyLastUpdate', new Date().toDateString());
                displayDutyStudents();
            }
        }

        // è¨ˆç®—å…©å€‹æ—¥æœŸä¹‹é–“çš„å·¥ä½œæ—¥æ•¸é‡ï¼ˆè·³éé€±æœ«ï¼‰
        function calculateWorkdays(startDate, endDate) {
            let count = 0;
            let current = new Date(startDate);
            current.setHours(0, 0, 0, 0);
            const end = new Date(endDate);
            end.setHours(0, 0, 0, 0);

            while (current < end) {
                current.setDate(current.getDate() + 1);
                const dayOfWeek = current.getDay();
                // 0=é€±æ—¥, 6=é€±å…­ï¼Œè·³é
                if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                    count++;
                }
            }
            return count;
        }

        // è‡ªå‹•æ›´æ–°å€¼æ—¥ç”Ÿï¼ˆæ¯å¤©è‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°ï¼‰
        function autoUpdateDuty() {
            const today = new Date().toDateString();
            const lastUpdate = localStorage.getItem('dutyLastUpdate');

            // ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œè¨˜éŒ„ä»Šå¤©çš„æ—¥æœŸ
            if (!lastUpdate) {
                localStorage.setItem('dutyLastUpdate', today);
                return;
            }

            // å¦‚æœæ˜¯åŒä¸€å¤©ï¼Œä¸éœ€è¦æ›´æ–°
            if (lastUpdate === today) {
                return;
            }

            // è¨ˆç®—ç¶“éäº†å¤šå°‘å€‹å·¥ä½œæ—¥
            const lastDate = new Date(lastUpdate);
            const todayDate = new Date(today);
            const workdaysPassed = calculateWorkdays(lastDate, todayDate);

            // å¦‚æœæœ‰ç¶“éå·¥ä½œæ—¥ï¼Œè‡ªå‹•å‰é€²
            if (workdaysPassed > 0) {
                const total = parseInt(localStorage.getItem('totalStudents') || '30');
                const currentStart = parseInt(localStorage.getItem('dutyStart') || '1');

                // æ¯å€‹å·¥ä½œæ—¥å‰é€²2å€‹åº§è™Ÿ
                const advancement = workdaysPassed * 2;
                const newStart = ((currentStart - 1 + advancement) % total) + 1;

                localStorage.setItem('dutyStart', newStart);
                localStorage.setItem('dutyLastUpdate', today);

                console.log(`å€¼æ—¥ç”Ÿå·²è‡ªå‹•æ›´æ–°ï¼ç¶“é ${workdaysPassed} å€‹å·¥ä½œæ—¥`);
            }
        }

        // å­¸ç”Ÿåå–®ç®¡ç†
        function saveStudentNames() {
            const names = document.getElementById('studentNames').value.trim().split('\n').filter(n => n);
            localStorage.setItem('studentNames', JSON.stringify(names));
            localStorage.setItem('totalStudents', names.length);
            document.getElementById('totalStudents').value = names.length;
            alert('å­¸ç”Ÿåå–®å·²å„²å­˜ï¼');
            displayDutyStudents();
        }

        function loadStudentNames() {
            const names = JSON.parse(localStorage.getItem('studentNames') || '[]');
            document.getElementById('studentNames').value = names.join('\n');
        }

        // ä½œæ¥­é»åç³»çµ±
        function saveHomeworkRecord() {
            const homeworkName = document.getElementById('homeworkName').value.trim();
            const missingInput = document.getElementById('missingStudents').value.trim();
            const leaveInput = document.getElementById('leaveStudents').value.trim();

            if (!homeworkName) {
                alert('è«‹è¼¸å…¥ä½œæ¥­åç¨±ï¼');
                return;
            }

            // è§£æåº§è™Ÿï¼ˆç§»é™¤ç©ºæ ¼ï¼Œåˆ†å‰²é€—è™Ÿï¼‰
            const missingNumbers = missingInput ? missingInput.split(',').map(n => n.trim()).filter(n => n) : [];
            const leaveNumbers = leaveInput ? leaveInput.split(',').map(n => n.trim()).filter(n => n) : [];

            if (missingNumbers.length === 0 && leaveNumbers.length === 0) {
                alert('è«‹è‡³å°‘è¼¸å…¥ä¸€ä½ç¼ºäº¤æˆ–è«‹å‡çš„å­¸ç”Ÿåº§è™Ÿï¼');
                return;
            }

            // ç²å–å­¸ç”Ÿåå–®
            const studentNames = JSON.parse(localStorage.getItem('studentNames') || '[]');

            // å»ºç«‹ä½œæ¥­è¨˜éŒ„
            const homeworkRecord = {
                name: homeworkName,
                missing: missingNumbers,
                leave: leaveNumbers,
                timestamp: Date.now()
            };

            // å„²å­˜è¨˜éŒ„
            localStorage.setItem('currentHomework', JSON.stringify(homeworkRecord));

            // é¡¯ç¤ºè¨˜éŒ„
            displayHomeworkRecord(homeworkRecord, studentNames);
        }

        function displayHomeworkRecord(record, studentNames) {
            const display = document.getElementById('homeworkDisplay');
            let html = `<div class="homework-title">ğŸ“š ${record.name}</div>`;

            // é¡¯ç¤ºç¼ºäº¤è€…
            if (record.missing.length > 0) {
                html += `<div class="homework-section">
                    <div class="homework-section-title missing">âŒ ç¼ºäº¤åå–®ï¼ˆ${record.missing.length}äººï¼‰</div>`;

                record.missing.forEach(seatNum => {
                    const index = parseInt(seatNum) - 1;
                    const name = studentNames[index] || 'æœªè¨­å®š';
                    html += `<div class="homework-student-item missing">åº§è™Ÿ ${seatNum}ï¼š${name}</div>`;
                });

                html += `</div>`;
            }

            // é¡¯ç¤ºè«‹å‡è€…
            if (record.leave.length > 0) {
                html += `<div class="homework-section">
                    <div class="homework-section-title leave">ğŸ¥ è«‹å‡åå–®ï¼ˆ${record.leave.length}äººï¼‰</div>`;

                record.leave.forEach(seatNum => {
                    const index = parseInt(seatNum) - 1;
                    const name = studentNames[index] || 'æœªè¨­å®š';
                    html += `<div class="homework-student-item leave">åº§è™Ÿ ${seatNum}ï¼š${name}</div>`;
                });

                html += `</div>`;
            }

            display.innerHTML = html;
        }

        function clearHomeworkDisplay() {
            document.getElementById('homeworkName').value = '';
            document.getElementById('missingStudents').value = '';
            document.getElementById('leaveStudents').value = '';
            document.getElementById('homeworkDisplay').innerHTML =
                '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">è«‹è¼¸å…¥ä½œæ¥­åç¨±ä¸¦æ¨™è¨˜å­¸ç”Ÿ</div>';
            localStorage.removeItem('currentHomework');
        }

        function loadCurrentHomework() {
            const record = JSON.parse(localStorage.getItem('currentHomework') || 'null');
            if (record) {
                document.getElementById('homeworkName').value = record.name;
                document.getElementById('missingStudents').value = record.missing.join(', ');
                document.getElementById('leaveStudents').value = record.leave.join(', ');

                const studentNames = JSON.parse(localStorage.getItem('studentNames') || '[]');
                displayHomeworkRecord(record, studentNames);
            }
        }

        // è¯çµ¡ç°¿ç³»çµ±
        function addContactItem() {
            const text = document.getElementById('contactText').value.trim();

            if (!text) {
                alert('è«‹è¼¸å…¥è¯çµ¡ç°¿äº‹é …ï¼');
                return;
            }

            const contacts = JSON.parse(localStorage.getItem('contactItems') || '[]');
            const now = new Date();
            const dateStr = `${now.getFullYear()}/${String(now.getMonth() + 1).padStart(2, '0')}/${String(now.getDate()).padStart(2, '0')}`;

            contacts.unshift({
                id: Date.now(),
                date: dateStr,
                content: text
            });

            localStorage.setItem('contactItems', JSON.stringify(contacts));
            document.getElementById('contactText').value = '';
            displayContactItems();
        }

        function displayContactItems() {
            const contacts = JSON.parse(localStorage.getItem('contactItems') || '[]');
            const list = document.getElementById('contactList');

            if (contacts.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.7); padding: 20px;">å°šç„¡è¯çµ¡ç°¿äº‹é …</div>';
                return;
            }

            list.innerHTML = contacts.map(item => `
                <div class="contact-item">
                    <div class="date">${item.date}</div>
                    <div class="content">${item.content}</div>
                    <button onclick="deleteContactItem(${item.id})">åˆªé™¤</button>
                </div>
            `).join('');
        }

        function deleteContactItem(id) {
            if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹è¯çµ¡ç°¿äº‹é …å—ï¼Ÿ')) return;

            const contacts = JSON.parse(localStorage.getItem('contactItems') || '[]');
            const filtered = contacts.filter(item => item.id !== id);
            localStorage.setItem('contactItems', JSON.stringify(filtered));
            displayContactItems();
        }

        // åˆå§‹åŒ–
        function init() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            showDailyQuote();
            displayReminders();
            autoUpdateDuty(); // è‡ªå‹•æª¢æŸ¥ä¸¦æ›´æ–°å€¼æ—¥ç”Ÿ
            displayDutyStudents();
            loadStudentNames();
            loadCurrentHomework(); // è¼‰å…¥ä½œæ¥­è¨˜éŒ„
            displayContactItems();

            // æ¸…ç†éæœŸçš„æé†’æª¢æŸ¥è¨˜éŒ„
            const today = new Date().toDateString();
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith('checked_') && !key.includes(today)) {
                    localStorage.removeItem(key);
                }
            });
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
